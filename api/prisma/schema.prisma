generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum TipoUsuario {
  PLAYER
  DONO_TIME
  DONO_SOCIETY
}

enum TipoPagamento {
  AVULSO
  MENSALISTA
  CONSUMO_BAR
}

enum TipoCampeonato {
  MATA_MATA
  GRUPOS
}

model Usuario {
  id           Int       @id @default(autoincrement())
  nome         String
  cpf          String?   @unique
  email        String    @unique
  senha        String
  telefone     String?
  pernaMelhor  String?
  posicaoCampo String?
  altura       Float?
  peso         Float?
  modalidade   String?
  nascimento   DateTime?
  goleiro      Boolean?
  sexo         String?

  tipo TipoUsuario @default(PLAYER)

  times Time[] @relation("TimeDono")

  timeRelacionadoId Int?
  timeRelacionado   Time? @relation("TimeJogadores", fields: [timeRelacionadoId], references: [id])

  societies      Society[]         @relation("UsuarioSocieties")
  pagamentos     Pagamento[]
  notificacoes   Notificacao[]
  societyPlayers SocietyPlayer[]
  estatisticas   EstatisticaJogo[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Society {
  id        Int     @id @default(autoincrement())
  usuarioId Int
  dono      Usuario @relation("UsuarioSocieties", fields: [usuarioId], references: [id])

  imagem    String?
  nome      String
  descricao String?
  telefone  String?
  whatsapp  String?
  email     String?
  website   String?
  instagram String?
  facebook  String?
  youtube   String?

  cep      String?
  endereco String?
  estado   String?
  cidade   String?

  cardapio       Cardapio[]
  campos         Campo[]
  societyPlayers SocietyPlayer[]
  pagamentos     Pagamento[]
  campeonatos    Campeonato[]

  // times do society
  times Time[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cardapio {
  id        Int     @id @default(autoincrement())
  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  nome  String
  preco Float

  createdAt DateTime @default(now())
}

model Campo {
  id        Int     @id @default(autoincrement())
  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  nome          String
  valorAvulso   Float?
  valorMensal   Float?
  foto          String?
  dimensoes     String?
  estiloGramado String?

  createdAt DateTime @default(now())
}

model Time {
  id         Int     @id @default(autoincrement())
  nome       String
  brasao     String?
  descricao  String?
  estado     String?
  cidade     String?
  modalidade String?

  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  donoId Int
  dono   Usuario @relation("TimeDono", fields: [donoId], references: [id])

  jogadores Usuario[] @relation("TimeJogadores")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  timeCampeonatos TimeCampeonato[]
  jogosMandante   Jogo[]           @relation("JogoTimeA")
  jogosVisitante  Jogo[]           @relation("JogoTimeB")

  // campe√£o / vice (relacionamentos diferentes)
  campeonatosVencidos Campeonato[] @relation("CampeaoTime")
  campeonatosVice     Campeonato[] @relation("ViceCampeaoTime")

  timeGrupos TimeGrupo[]

  // impede time duplicado por nome dentro do mesmo society
  @@unique([societyId, nome])
}

model Pagamento {
  id        Int     @id @default(autoincrement())
  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  tipo      TipoPagamento
  valor     Float
  descricao String?

  createdAt DateTime @default(now())
}

model SocietyPlayer {
  id Int @id @default(autoincrement())

  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  createdAt DateTime @default(now())
}

model Notificacao {
  id        Int     @id @default(autoincrement())
  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  titulo   String
  mensagem String
  lido     Boolean @default(false)

  createdAt DateTime @default(now())
}

model Campeonato {
  id        Int     @id @default(autoincrement())
  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  nome     String
  tipo     TipoCampeonato
  maxTimes Int

  // GRUPOS | MATA_MATA | FINALIZADO
  faseAtual  String @default("GRUPOS")
  roundAtual Int    @default(1)

  campeaoId Int?
  campeao   Time? @relation("CampeaoTime", fields: [campeaoId], references: [id])

  viceCampeaoId Int?
  viceCampeao   Time? @relation("ViceCampeaoTime", fields: [viceCampeaoId], references: [id])

  times  TimeCampeonato[]
  grupos Grupo[]
  jogos  Jogo[]

  createdAt DateTime @default(now())
}

model TimeCampeonato {
  id           Int        @id @default(autoincrement())
  campeonatoId Int
  campeonato   Campeonato @relation(fields: [campeonatoId], references: [id])

  timeId Int
  time   Time @relation(fields: [timeId], references: [id])

  @@unique([campeonatoId, timeId])
}

model Grupo {
  id           Int        @id @default(autoincrement())
  nome         String
  campeonatoId Int
  campeonato   Campeonato @relation(fields: [campeonatoId], references: [id])

  timesGrupo TimeGrupo[]
  jogos      Jogo[]
}

model TimeGrupo {
  id      Int   @id @default(autoincrement())
  grupoId Int
  grupo   Grupo @relation(fields: [grupoId], references: [id])

  timeId Int
  time   Time @relation(fields: [timeId], references: [id])

  pontos     Int @default(0)
  vitorias   Int @default(0)
  empates    Int @default(0)
  derrotas   Int @default(0)
  golsPro    Int @default(0)
  golsContra Int @default(0)
  saldoGols  Int @default(0)

  @@unique([grupoId, timeId])
}

model Jogo {
  id           Int        @id @default(autoincrement())
  campeonatoId Int
  campeonato   Campeonato @relation(fields: [campeonatoId], references: [id])

  round   Int
  grupoId Int?
  grupo   Grupo? @relation(fields: [grupoId], references: [id])

  timeAId Int
  timeA   Time @relation("JogoTimeA", fields: [timeAId], references: [id])

  timeBId Int
  timeB   Time @relation("JogoTimeB", fields: [timeBId], references: [id])

  golsA      Int?
  golsB      Int?
  vencedorId Int?
  finalizado Boolean @default(false)

  estatisticas EstatisticaJogo[]
}

model EstatisticaJogo {
  id     Int  @id @default(autoincrement())
  jogoId Int
  jogo   Jogo @relation(fields: [jogoId], references: [id])

  jogadorId Int
  jogador   Usuario @relation(fields: [jogadorId], references: [id])

  gols      Int @default(0)
  amarelos  Int @default(0)
  vermelhos Int @default(0)
}
