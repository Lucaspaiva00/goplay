generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum TipoUsuario {
  PLAYER
  DONO_TIME
  DONO_SOCIETY
}

enum TipoPagamento {
  AVULSO
  MENSALISTA
  CONSUMO_BAR
}

enum TipoCampeonato {
  MATA_MATA
  GRUPOS
}

model Usuario {
  id           Int       @id @default(autoincrement())
  nome         String
  cpf          String?   @unique
  email        String    @unique
  senha        String
  telefone     String?
  pernaMelhor  String?
  posicaoCampo String?
  altura       Float?
  peso         Float?
  modalidade   String?
  nascimento   DateTime?
  goleiro      Boolean?
  sexo         String?

  tipo TipoUsuario @default(PLAYER)

  // Dono de times
  times Time[] @relation("TimeDono")

  // Jogador em um time
  timeRelacionadoId Int?
  timeRelacionado   Time? @relation("TimeJogadores", fields: [timeRelacionadoId], references: [id])

  // Dono de societies
  societies Society[] @relation("UsuarioSocieties")

  pagamentos     Pagamento[]
  notificacoes   Notificacao[]
  societyPlayers SocietyPlayer[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Society {
  id        Int     @id @default(autoincrement())
  usuarioId Int
  dono      Usuario @relation("UsuarioSocieties", fields: [usuarioId], references: [id])

  imagem    String?
  nome      String
  descricao String?
  telefone  String?
  whatsapp  String?
  email     String?
  website   String?
  instagram String?
  facebook  String?
  youtube   String?

  cep      String?
  endereco String?
  estado   String?
  cidade   String?

  cardapio       Cardapio[]
  campos         Campo[]
  societyPlayers SocietyPlayer[]
  pagamentos     Pagamento[]
  campeonatos    Campeonato[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cardapio {
  id        Int     @id @default(autoincrement())
  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  nome  String
  preco Float

  createdAt DateTime @default(now())
}

model Campo {
  id        Int     @id @default(autoincrement())
  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  nome          String
  valorAvulso   Float?
  valorMensal   Float?
  foto          String?
  dimensoes     String?
  estiloGramado String?

  createdAt DateTime @default(now())
}

model Time {
  id         Int     @id @default(autoincrement())
  nome       String
  brasao     String?
  descricao  String?
  estado     String?
  cidade     String?
  modalidade String?

  donoId Int
  dono   Usuario @relation("TimeDono", fields: [donoId], references: [id])

  jogadores Usuario[] @relation("TimeJogadores")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  timeCampeonatos     TimeCampeonato[]
  jogosMandante       Jogo[]           @relation("JogoTimeA")
  jogosVisitante      Jogo[]           @relation("JogoTimeB")
  campeonatosVencidos Campeonato[]     @relation("CampeaoTime")
}

model Pagamento {
  id        Int     @id @default(autoincrement())
  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  tipo      TipoPagamento
  valor     Float
  descricao String?

  createdAt DateTime @default(now())
}

model SocietyPlayer {
  id Int @id @default(autoincrement())

  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  createdAt DateTime @default(now())
}

model Notificacao {
  id        Int     @id @default(autoincrement())
  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])

  titulo   String
  mensagem String
  lido     Boolean @default(false)

  createdAt DateTime @default(now())
}

model Campeonato {
  id        Int     @id @default(autoincrement())
  societyId Int
  society   Society @relation(fields: [societyId], references: [id])

  nome       String
  tipo       TipoCampeonato
  maxTimes   Int
  roundAtual Int            @default(1)

  campeaoId Int?
  campeao   Time? @relation("CampeaoTime", fields: [campeaoId], references: [id])

  times TimeCampeonato[]
  jogos Jogo[]

  createdAt DateTime @default(now())
}

model TimeCampeonato {
  id           Int        @id @default(autoincrement())
  campeonatoId Int
  campeonato   Campeonato @relation(fields: [campeonatoId], references: [id])

  timeId Int
  time   Time @relation(fields: [timeId], references: [id])
}

model Jogo {
  id           Int        @id @default(autoincrement())
  campeonatoId Int
  campeonato   Campeonato @relation(fields: [campeonatoId], references: [id])

  round Int

  timeAId Int
  timeA   Time @relation("JogoTimeA", fields: [timeAId], references: [id])

  timeBId Int
  timeB   Time @relation("JogoTimeB", fields: [timeBId], references: [id])

  golsA      Int?
  golsB      Int?
  vencedorId Int?
  finalizado Boolean @default(false)
}
